!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],r):r((e=e||self).ReactQuery={},e.React)}(this,(function(e,r){"use strict";function t(){return(t=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function n(e,r){if(null==e)return{};var t,n,u={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||(u[t]=e[t]);return u}r=r&&r.hasOwnProperty("default")?r.default:r;var u=0,i=function(){return u++},o={},c="undefined"==typeof window,a=function(){},f=console||{error:a,warn:a,log:a};function s(e){var t=r.useRef();return t.current=e,r.useCallback((function(){return t.current}),[])}function l(e,r){return"function"==typeof e?e(r):e}function d(e,r){return v(r)?Object.assign.apply(Object,[{}].concat(Object.keys(r).sort().map((function(e){var t;return(t={})[e]=r[e],t})))):r}function h(e){return JSON.stringify(e,d)}function v(e){return e&&"object"==typeof e&&!Array.isArray(e)}function y(){return"undefined"==typeof document||void 0===document.visibilityState||"visible"===document.visibilityState||"prerender"===document.visibilityState}function p(e){if(v(e[0])){if(e[0].hasOwnProperty("queryKey")&&e[0].hasOwnProperty("queryFn")){var r=e[0],t=r.queryKey,n=r.variables,u=void 0===n?[]:n,i=r.queryFn,o=r.config;return[t,u,i,void 0===o?{}:o]}throw new Error("queryKey and queryFn keys are required.")}if("function"==typeof e[2]){var c=e[0],a=e[1],f=void 0===a?[]:a,s=e[2],l=e[3];return[c,f,s,void 0===l?{}:l]}var d=e[0],h=e[1],y=e[2];return[d,[],h,void 0===y?{}:y]}function g(e){var t=r.useRef(!1);return r[c?"useEffect":"useLayoutEffect"]((function(){return t.current=!0,function(){return t.current=!1}}),[]),r.useCallback((function(){return t.current?e.apply(void 0,arguments):void 0}),[e])}function m(e){if((e.config.suspense||e.config.useErrorBoundary)&&"error"===e.status)throw e.error;if(e.config.suspense&&"loading"===e.status)throw e.query.wasSuspended=!0,e.refetch()}var w=r.createContext(),b={current:{retry:3,retryDelay:function(e){return Math.min(1e3*Math.pow(2,e),3e4)},staleTime:0,cacheTime:3e5,refetchAllOnWindowFocus:!0,refetchInterval:!1,suspense:!1,queryKeySerializerFn:function e(r){if(!r)return[];if("function"==typeof r)try{return e(r())}catch(e){return[]}"string"==typeof r&&(r=[r]);var t=h(r);return r=JSON.parse(t),[t,r]},queryFnParamsFilter:function(e){return e},throwOnError:!1,useErrorBoundary:void 0,onMutate:a,onSuccess:a,onError:a,onSettled:a,refetchOnMount:!0,isDataEqual:function e(r,t){if(r===t)return!0;if(r&&t&&"object"==typeof r&&"object"==typeof t){var n,u,i;if(Array.isArray(r)){if((n=r.length)!=t.length)return!1;for(u=n;0!=u--;)if(!e(r[u],t[u]))return!1;return!0}if((n=(i=Object.keys(r)).length)!==Object.keys(t).length)return!1;for(u=n;0!=u--;)if(!Object.prototype.hasOwnProperty.call(t,i[u]))return!1;for(u=n;0!=u--;){var o=i[u];if(!e(r[o],t[o]))return!1}return!0}return r!=r&&t!=t}}};function q(){return r.useContext(w)||b.current}function S(e,r,t){return t?r?r(e):e:(e&&e.then||(e=Promise.resolve(e)),r?e.then(r):e)}function F(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}function E(e){return function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];try{return Promise.resolve(e.apply(this,r))}catch(e){return Promise.reject(e)}}}function O(e,r){var t=e();return t&&t.then?t.then(r):r(t)}var I=function(){var e=[],r={queries:{},isFetching:0},u=function(){r.isFetching=Object.values(I.queries).reduce((function(e,r){return r.state.isFetching?e+1:e}),0),e.forEach((function(e){return e(r)}))};r.subscribe=function(r){return e.push(r),function(){e.splice(e.indexOf(r),1)}},r.clear=function(){r.queries={},u()};var i=function(e,t){var n=(void 0===t?{}:t).exact;if("function"!=typeof e){var u=b.current.queryKeySerializerFn(e),i=u[0],o=u[1];e=function(e){return n?e.queryHash===i:function e(r,t){return typeof r==typeof t&&("object"==typeof r?!Object.keys(t).some((function(n){return!e(r[n],t[n])})):r===t)}(e.queryKey,o)}}return Object.values(r.queries).filter(e)};return r.getQueries=i,r.getQuery=function(e){return i(e,{exact:!0})[0]},r.getQueryData=function(e){var t;return null==(t=r.getQuery(e))?void 0:t.state.data},r.removeQueries=function(e,t){var n=(void 0===t?{}:t).exact,o=i(e,{exact:n});o.forEach((function(e){clearTimeout(e.staleTimeout),delete r.queries[e.queryHash]})),o.length&&u()},r.refetchQueries=E((function(e,t){var n=void 0===t?{}:t,u=n.exact,o=n.throwOnError,c=n.force,a=!0===e?Object.values(r.queries):i(e,{exact:u});return F((function(){return S(Promise.all(a.map((function(e){return e.fetch({force:c})}))))}),(function(e){if(o)throw e}))})),r._buildQuery=function(e,n,i,f){var s=f.queryKeySerializerFn(e),d=s[0],h=s[1],v=r.queries[d];return v?(Object.assign(v,{queryVariables:n,queryFn:i}),v.config=t({},v.config,{},f)):(v=function(e){var n=e.config.queryReducer||k,i=void 0===e.queryHash,c="function"==typeof e.config.initialData?e.config.initialData():e.config.initialData,f=void 0!==c,s=!!i||!f,d=e.config.manual,h=t({},e,{instances:[],state:n(void 0,{type:P,initialStatus:i||d||f?"success":"loading",initialData:c,hasInitialData:f,isStale:s,manual:d})}),v=function(e){h.state=n(h.state,e),h.instances.forEach((function(e){return e.onStateUpdate(h.state)})),u()};h.scheduleStaleTimeout=function(){h.config.staleTime!==1/0&&(h.staleTimeout=setTimeout((function(){I.getQuery(h.queryKey)&&v({type:j})}),h.config.staleTime))},h.scheduleGarbageCollection=function(){h.config.cacheTime!==1/0&&(v({type:M}),h.cacheTimeout=setTimeout((function(){r.removeQueries((function(e){return e.state.markedForGarbageCollection&&e.queryHash===h.queryHash}))}),void 0===h.state.data&&"error"!==h.state.status?0:h.config.cacheTime))},h.heal=function(){clearTimeout(h.cacheTimeout),h.cancelled=null},h.updateInstance=function(e){var r=h.instances.find((function(r){return r.id===e.id}));r?Object.assign(r,e):(r=t({onStateUpdate:a},e),h.instances.push(e))},h.subscribe=function(e){return h.heal(),function(){h.instances=h.instances.filter((function(r){return r.id!==e})),h.instances.length||(h.cancelled=o,h.cancelQueries&&h.cancelQueries(),h.scheduleGarbageCollection())}};var p=E((function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];return F((function(){var r=e.apply(void 0,h.config.queryFnParamsFilter(t));return h.cancelQueries=function(){return null==r.cancel?void 0:r.cancel()},S(r,(function(e){if(delete h.cancelQueries,h.cancelled)throw h.cancelled;return e}))}),(function(r){var n=!1;if(delete h.cancelQueries,h.cancelled)throw h.cancelled;return v({type:C}),O((function(){if(!0===h.config.retry||h.state.failureCount<=h.config.retry||"function"==typeof h.config.retry&&h.config.retry(h.state.failureCount,r)){if(!y())return h.shouldContinueRetryOnFocus=!0,n=!0,new Promise(a);delete h.shouldContinueRetryOnFocus;var u=l(h.config.retryDelay,h.state.failureCount);return n=!0,S(new Promise((function(r,n){setTimeout(E((function(){return h.cancelled?n(h.cancelled):F((function(){return S(p.apply(void 0,[e].concat(t)),(function(e){if(h.cancelled)return n(h.cancelled);r(e)}))}),(function(e){if(h.cancelled)return n(h.cancelled);n(e)}))})),u)})))}}),(function(e){if(n)return e;throw r}))}))}));return h.fetch=E((function(e){var r=void 0===e?{}:e,t=r.force,n=r.__queryFn,u=void 0===n?h.queryFn:n;if(h.queryHash&&(h.state.isStale||t))return h.promise||(h.promise=E((function(){return h.cancelled=null,F((function(){return v({type:Q}),S(p.apply(void 0,[u].concat(h.queryKey,h.queryVariables)),(function(e){return h.setData((function(r){return h.config.isDataEqual(r,e)?r:e})),h.instances.forEach((function(e){return e.onSuccess&&e.onSuccess(h.state.data)})),h.instances.forEach((function(e){return e.onSettled&&e.onSettled(h.state.data,null)})),delete h.promise,e}))}),(function(e){if(v({type:T,cancelled:e===h.cancelled,error:e}),delete h.promise,e!==h.cancelled)throw h.instances.forEach((function(r){return r.onError&&r.onError(e)})),h.instances.forEach((function(r){return r.onSettled&&r.onSettled(void 0,e)})),e}))}))()),h.promise})),h.setState=function(e){return v({type:R,updater:e})},h.setData=function(e){v({type:D,updater:e}),clearTimeout(h.staleTimeout),h.scheduleStaleTimeout()},h}({queryKey:h,queryHash:d,queryVariables:n,queryFn:i,config:f}),!c&&v.state.data&&(v.scheduleStaleTimeout(),v.heal(),v.scheduleGarbageCollection()),v.queryHash&&(c||(r.queries[d]=v,setTimeout((function(){u()}))))),v},r.prefetchQuery=E((function(){for(var e=!1,u=arguments.length,i=new Array(u),o=0;o<u;o++)i[o]=arguments[o];var c=p(i),a=c[0],f=c[1],s=c[2],l=c[3],d=l.force,h=n(l,["force"]);h=t({},b.current,{},h);var v=r._buildQuery(a,f,s,h);return O((function(){if(v.state.isStale||d)return F((function(){return S(v.fetch({force:d}),(function(r){return v.wasPrefetched=!0,e=!0,r}))}),(function(e){if(h.throwOnError)throw e}))}),(function(r){return e?r:v.state.data}))})),r.setQueryData=function(e,u,o){void 0===o&&(o={});var c=o,f=c.exact,s=n(c,["exact"]),l=i(e,{exact:f});l.length||"function"==typeof e||(l=[r._buildQuery(e,void 0,(function(){return new Promise(a)}),t({},b.current,{},s))]),l.forEach((function(e){return e.setData(u)}))},r}(),P={},C={},j={},M={},Q={},D={},T={},R={};function k(e,r){switch(r.type){case P:return{status:r.initialStatus,error:null,isFetching:!r.hasInitialData&&!r.manual&&"loading"===r.initialStatus,canFetchMore:!1,failureCount:0,isStale:r.isStale,markedForGarbageCollection:!1,data:r.initialData,updatedAt:r.hasInitialData?Date.now():0};case C:return t({},e,{failureCount:e.failureCount+1});case j:return t({},e,{isStale:!0});case M:return t({},e,{markedForGarbageCollection:!0});case Q:return t({},e,{status:"error"===e.status?"loading":e.status,isFetching:!0,failureCount:0});case D:return t({},e,{status:"success",data:l(r.updater,e.data),error:null,isStale:!1,isFetching:!1,canFetchMore:r.canFetchMore,updatedAt:Date.now(),failureCount:0});case T:return t({},e,{isFetching:!1,isStale:!0},!r.cancelled&&{status:"error",error:r.error});case R:return l(r.updater,e);default:throw new Error}}var x,A=function(){var e=b.current.refetchAllOnWindowFocus;y()&&(void 0===navigator.onLine||navigator.onLine)&&I.refetchQueries((function(r){return!!r.instances.length&&(!0!==r.config.manual&&(r.shouldContinueRetryOnFocus?(delete r.promise,!0):void 0===r.config.refetchOnWindowFocus?e:r.config.refetchOnWindowFocus))})).catch(f.error)};function H(e){x&&x(),x=e(A)}function K(e,r,t){return t?r?r(e):e:(e&&e.then||(e=Promise.resolve(e)),r?e.then(r):e)}H((function(e){var r;if(!c&&(null==(r=window)?void 0:r.addEventListener))return window.addEventListener("visibilitychange",e,!1),window.addEventListener("focus",e,!1),function(){window.removeEventListener("visibilitychange",e),window.removeEventListener("focus",e)}}));var _=function(){return{status:"idle",data:void 0,error:null}};function L(){}var V={};function B(e,r){if(!r)return e&&e.then?e.then(L):Promise.resolve()}var G={};function W(e,r){var t=e();return t&&t.then?t.then(r):r(t)}var z={};var U={};function J(e){return function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];try{return Promise.resolve(e.apply(this,r))}catch(e){return Promise.reject(e)}}}function N(e,r){if(r.type===V)return{status:"idle",data:void 0,error:null};if(r.type===G)return{status:"loading"};if(r.type===z)return{status:"success",data:r.data};if(r.type===U)return{status:"error",error:r.error};throw new Error}function X(e,u,o,c){void 0===c&&(c={});var a,l=(null===(a=r.useRef(null)).current&&(a.current=i()),a.current);c=t({},q(),{},c);var d=r.useRef(),h=I._buildQuery(e,u,o,c);d.current&&void 0===d.current.queryHash&&void 0===h.queryHash||(d.current=h);var v,p=d.current,m=g(r.useState()[1]),w=s(c),b=r.useCallback((v=function(e){void 0===e&&(e={});var r=e,t=r.throwOnError,u=n(r,["throwOnError"]);return function(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}((function(){return e=p.fetch(u),t?r?r(e):e:(e&&e.then||(e=Promise.resolve(e)),r?e.then(r):e);var e,r,t}),(function(e){if(t)throw e}))},function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];try{return Promise.resolve(v.apply(this,e))}catch(e){return Promise.reject(e)}}),[p]);return p.updateInstance({id:l,onStateUpdate:function(){return m({})},onSuccess:function(e){return w().onSuccess(e)},onError:function(e){return w().onError(e)},onSettled:function(e,r){return w().onSettled(e,r)}}),r.useEffect((function(){return p.subscribe(l)}),[w,l,p,m]),r.useEffect((function(){w().manual||p.wasPrefetched||p.wasSuspended||!p.state.isStale||!w().refetchOnMount&&1!==p.instances.length||b().catch(f.error),p.wasPrefetched=!1,p.wasSuspended=!1}),[w,p,b]),r.useEffect((function(){var e=d.current;if(c.refetchInterval&&(!e.currentRefetchInterval||c.refetchInterval<e.currentRefetchInterval))return e.currentRefetchInterval=c.refetchInterval,clearInterval(e.refetchIntervalId),e.refetchIntervalId=setInterval((function(){(y()||c.refetchIntervalInBackground)&&b().catch(f.error)}),c.refetchInterval),function(){clearInterval(e.refetchIntervalId),delete e.refetchIntervalId,delete e.currentRefetchInterval}}),[c.refetchInterval,c.refetchIntervalInBackground,b]),t({},p.state,{config:c,query:p,refetch:b})}function Y(e,r,t){return t?r?r(e):e:(e&&e.then||(e=Promise.resolve(e)),r?e.then(r):e)}function Z(){}function $(e){var r=e();if(r&&r.then)return r.then(Z)}function ee(e,r,t){if(!e.s){if(t instanceof re){if(!t.s)return void(t.o=ee.bind(null,e,r));1&r&&(r=t.s),t=t.v}if(t&&t.then)return void t.then(ee.bind(null,e,r),ee.bind(null,e,2));e.s=r,e.v=t;var n=e.o;n&&n(e)}}var re=function(){function e(){}return e.prototype.then=function(r,t){var n=new e,u=this.s;if(u){var i=1&u?r:t;if(i){try{ee(n,1,i(this.v))}catch(e){ee(n,2,e)}return n}return this}return this.o=function(e){try{var u=e.v;1&e.s?ee(n,1,r?r(u):u):t?ee(n,1,t(u)):ee(n,2,u)}catch(e){ee(n,2,e)}},n},e}();function te(e){return e instanceof re&&1&e.s}function ne(e,r){var t;do{var n=e();if(n&&n.then){if(!te(n)){t=!0;break}n=n.v}var u=r();if(te(u)&&(u=u.v),!u)return n}while(!u.then);var i=new re,o=ee.bind(null,i,2);return(t?n.then(c):u.then(a)).then(void 0,o),i;function c(t){for(n=t;te(u=r())&&(u=u.v),u;){if(u.then)return void u.then(a).then(void 0,o);if((n=e())&&n.then){if(!te(n))return void n.then(c).then(void 0,o);n=n.v}}ee(i,1,n)}function a(t){if(t){do{if((n=e())&&n.then){if(!te(n))return void n.then(c).then(void 0,o);n=n.v}if(te(t=r())&&(t=t.v),!t)return void ee(i,1,n)}while(!t.then);t.then(a).then(void 0,o)}else ee(i,1,n)}}function ue(e,r){return e&&e.then?e.then(r):r(e)}function ie(e){return function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];try{return Promise.resolve(e.apply(this,r))}catch(e){return Promise.reject(e)}}}function oe(e,r){if(e)throw r;return r}function ce(e,r){try{var t=e()}catch(e){return r(!0,e)}return t&&t.then?t.then(r.bind(null,!1),r.bind(null,!0)):r(!1,t)}e.ReactQueryConfigProvider=function(e){var n=e.config,u=e.children,i=r.useContext(w),o=r.useMemo((function(){var e=t({},i||b.current,{},n);return void 0===e.useErrorBoundary&&(e.useErrorBoundary=e.suspense),e}),[n,i]);return i||(b.current=o),r.createElement(w.Provider,{value:o},u)},e.queryCache=I,e.setConsole=function(e){f=e},e.setFocusHandler=H,e.stableStringify=h,e.statusError="error",e.statusIdle="idle",e.statusLoading="loading",e.statusSuccess="success",e.useInfiniteQuery=function(){for(var e=r.useRef(),n=arguments.length,u=new Array(n),i=0;i<n;i++)u[i]=arguments[i];var o=p(u),c=o[0],a=o[1],f=o[2],l=o[3],d=void 0===l?{}:l,h=d.getFetchMore,v=s(h),y=f,g=X(c,a,f=ie((function(){var r=!1,t=[],n=[].concat(e.current.query.pageVariables),u=[];return ue(ne((function(){var e=n.shift();return $((function(){if(t.length){var n=v()(t[t.length-1],t);if(!n)return void(r=!0);var i=[].concat(e.slice(0,-1),[n]),o=t.push;return Y(y.apply(void 0,i),(function(e){o.call(t,e),u.push(i)}))}var c=t.push;return Y(y.apply(void 0,e),(function(r){c.call(t,r),u.push(e)}))}))}),(function(){return!r&&!!n.length})),(function(){return e.current.query.canFetchMore=v()(t[t.length-1],t),e.current.query.pageVariables=u,t}))})),d);void 0===g.query.canFetchMore&&void 0!==g.data&&(g.query.canFetchMore=v()(g.data[g.data.length-1],g.data)),e.current=g;var w=g.refetch,b=g.data,q=void 0===b?[]:b,S=g.query.canFetchMore;g.query.pageVariables||(g.query.pageVariables=[[].concat(g.query.queryKey,g.query.queryVariables)]);var F=r.useCallback((function(r){return void 0===r&&(r=e.current.query.canFetchMore),e.current.query.canFetchMore?w({force:!0,__queryFn:ie((function(){for(var n=arguments.length,u=new Array(n),i=0;i<n;i++)u[i]=arguments[i];return ce((function(){e.current.query.setState((function(e){return t({},e,{isFetchingMore:!0})}));var n=[].concat(u,[r]);e.current.query.pageVariables.push(n);var i=e.current.data;return Y(y.apply(void 0,n),(function(r){var t=[].concat(i,[r]);return e.current.query.canFetchMore=v()(t[t.length-1],t),t}))}),(function(r,n){return e.current.query.setState((function(e){return t({},e,{isFetchingMore:!1})})),oe(r,n)}))}))}):void 0}),[v,y,w]);return m(g),t({},g,{data:q,canFetchMore:S,fetchMore:F})},e.useIsFetching=function(){var e=r.useState({}),t=e[0],n=e[1];return r.useEffect((function(){return I.subscribe((function(){return n({})}))}),[]),r.useMemo((function(){return t&&I.isFetching}),[t])},e.useMutation=function(e,n){void 0===n&&(n={});var u=r.useReducer(N,null,_),o=u[0],c=g(u[1]),l=s(e),d=s(t({},q(),{},n)),h=r.useRef(),v=r.useCallback(J((function(e,r){var t=void 0===r?{}:r,n=t.onSuccess,u=void 0===n?a:n,o=t.onError,s=void 0===o?a:o,v=t.onSettled,y=void 0===v?a:v,p=t.throwOnError,g=d(),m=i();h.current=m;var w,b=J((function(){return h.current===m}));return c({type:G}),function(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}((function(){return K(g.onMutate(e),(function(r){var t;return w=r,W((function(){if(b())return K(l()(e),(function(e){t=e}))}),(function(){return W((function(){if(b())return B(u(t,e))}),(function(){return W((function(){if(b())return B(g.onSuccess(t,e))}),(function(){return W((function(){if(b())return B(y(t,null,e))}),(function(){return W((function(){if(b())return B(g.onSettled(t,null,e))}),(function(){return b()&&c({type:z,data:t}),t}))}))}))}))}))}))}),(function(r){return W((function(){if(b())return f.error(r),B(s(r,e,w))}),(function(){return W((function(){if(b())return B(g.onError(r,e,w))}),(function(){return W((function(){if(b())return B(y(void 0,r,e,w))}),(function(){return W((function(){if(b())return B(g.onSettled(void 0,r,e,w))}),(function(){if(b()&&(c({type:U,error:r}),null!=p?p:g.throwOnError))throw r}))}))}))}))}))})),[c,d,l]),y=r.useCallback((function(){return c({type:V})}),[c]);return r.useEffect((function(){if(d().useErrorBoundary&&o.error)throw o.error}),[d,o.error]),[v,t({},o,{reset:y})]},e.usePaginatedQuery=function(){for(var e=arguments.length,n=new Array(e),u=0;u<e;u++)n[u]=arguments[u];var i=p(n),o=i[0],c=i[1],a=i[2],f=i[3],s=void 0===f?{}:f,l=r.useRef();void 0!==l.current&&delete s.initialData;var d=X(o,c,a,s),h=d.data,v=d.status;r.useEffect((function(){"success"===v&&void 0!==h&&(l.current=h)}),[h,v]);var y=h;return void 0===y&&(y=l.current),void 0!==y&&(v="success"),m(d),t({},d,{resolvedData:y,latestData:h,status:v})},e.useQuery=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];var n=X.apply(void 0,p(r));return m(n),n},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=react-query.production.min.js.map
